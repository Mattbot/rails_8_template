#!/bin/bash

# Pre-push hook to run linter before pushing

# Skip linting for Dependabot commits
if git log -1 --pretty=%an | grep -q "dependabot\[bot\]"; then
    echo "ğŸ¤– Dependabot push detected, skipping lint checks"
    exit 0
fi

# Skip linting if SKIP_LINT environment variable is set
if [ "$SKIP_LINT" = "true" ]; then
    echo "â­ï¸  Skipping lint checks (SKIP_LINT=true)"
    exit 0
fi

echo "ğŸ” Running linter before push..."

# Run RuboCop
if ! bundle exec rubocop; then
    echo "âŒ RuboCop lint check failed. Please fix the issues before pushing."
    echo "ğŸ’¡ Tip: Run 'bundle exec rubocop -A' to auto-fix most issues."
    echo "ğŸ’¡ Or set SKIP_LINT=true to skip this check"
    exit 1
fi

# TODO: Re-enable slim-lint after fixing template issues
# Run Slim-lint if slim files exist
# if find . -name "*.slim" -not -path "./tmp/*" -not -path "./vendor/*" | grep -q .; then
#     if ! bundle exec slim-lint app/views/; then
#         echo "âŒ Slim-lint check failed. Please fix the issues before pushing."
#         exit 1
#     fi
# fi

echo "âœ… All lint checks passed! Proceeding with push."
exit 0